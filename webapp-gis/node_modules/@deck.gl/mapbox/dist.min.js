(function webpackUniversalModuleDefinition(root, factory) {
  if (typeof exports === 'object' && typeof module === 'object')
    module.exports = factory();
  else if (typeof define === 'function' && define.amd) define([], factory);
        else if (typeof exports === 'object') exports['deck'] = factory();
  else root['deck'] = factory();})(globalThis, function () {
"use strict";var __exports__=(()=>{var ce=Object.create;var S=Object.defineProperty;var le=Object.getOwnPropertyDescriptor;var pe=Object.getOwnPropertyNames;var ue=Object.getPrototypeOf,de=Object.prototype.hasOwnProperty;var he=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),fe=(t,e)=>{for(var o in e)S(t,o,{get:e[o],enumerable:!0})},j=(t,e,o,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of pe(e))!de.call(t,n)&&n!==o&&S(t,n,{get:()=>e[n],enumerable:!(r=le(e,n))||r.enumerable});return t},h=(t,e,o)=>(j(t,e,"default"),o&&j(o,e,"default")),m=(t,e,o)=>(o=t!=null?ce(ue(t)):{},j(e||!t||!t.__esModule?S(o,"default",{value:t,enumerable:!0}):o,t)),me=t=>j(S({},"__esModule",{value:!0}),t);var f=he((Ge,q)=>{q.exports=globalThis.deck});var k={};fe(k,{MapboxOverlay:()=>E});var p={},H=m(f(),1);h(p,m(f(),1));if(!H.Layer)throw new Error("@deck.gl/core is not found");h(k,p);var u=m(f(),1);var b=m(f(),1);function O(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}var g=Math.PI,ve=g/4,V=g/180,We=180/g,G=512,be=4003e4;function v(t){let[e,o]=t;O(Number.isFinite(e)),O(Number.isFinite(o)&&o>=-90&&o<=90,"invalid latitude");let r=e*V,n=o*V,l=G*(r+g)/(2*g),s=G*(g+Math.log(Math.tan(ve+n*.5)))/(2*g);return[l,s]}function z(t){let e=Math.cos(t*V);return G/be/e}var Ke=Math.PI/180;var w="mapbox",N=512,Oe=Math.PI/180;function Q({map:t,deck:e}){if(t.__deck)return t.__deck;let o=e.props._customRender,r=e.props.onLoad,n={...e.props,_customRender:()=>{t.triggerRepaint(),o?.("")}};return n.views||=_(t),Object.assign(n,{width:null,height:null,touchAction:"unset",viewState:x(t)}),e.isInitialized?K(e,t):n.onLoad=()=>{r?.(),K(e,t)},e.setProps(n),t.__deck=e,t.on("render",()=>{e.isInitialized&&Fe(e,t)}),e}function K(t,e){let o=()=>{t.isInitialized?Re(t,e):e.off("move",o)};e.on("move",o)}function ee(t){t.__deck?.finalize(),t.__deck=null}function C(t,e){let o=e?{depthWriteEnabled:!0,depthCompare:"less-equal",depthBias:0,blend:!0,blendColorSrcFactor:"src-alpha",blendColorDstFactor:"one-minus-src-alpha",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one-minus-src-alpha",blendColorOperation:"add",blendAlphaOperation:"add"}:{};return F(t)==="globe"&&(o.cullMode="back"),o}function te(t,e,o,r){if(!t.isInitialized)return;let{currentViewport:n}=t.userData,l=!1;n||(n=A(t,e,r),t.userData.currentViewport=n,l=!0),t._drawLayers("mapbox-repaint",{viewports:[n],layerFilter:s=>(!t.props.layerFilter||t.props.layerFilter(s))&&(o.id===s.layer.id||s.layer.props.operation.includes("terrain")),clearStack:l,clearCanvas:!1})}function oe(t,e,o,r){if(!t.isInitialized)return;let{currentViewport:n}=t.userData,l=!1;n||(n=A(t,e,r),t.userData.currentViewport=n,l=!0),t._drawLayers("mapbox-repaint",{viewports:[n],layerFilter:s=>{if(t.props.layerFilter&&!t.props.layerFilter(s))return!1;let i=s.layer;return i.props.beforeId===o.beforeId&&i.props.slot===o.slot},clearStack:l,clearCanvas:!1})}function F(t){let e=t.getProjection?.(),o=e?.type||e?.name;if(o==="globe")return"globe";if(o&&o!=="mercator")throw new Error("Unsupported projection");return"mercator"}function _(t){return F(t)==="globe"?new b._GlobeView({id:w}):new b.MapView({id:w})}function x(t){let{lng:e,lat:o}=t.getCenter(),r={longitude:(e+540)%360-180,latitude:o,zoom:t.getZoom(),bearing:t.getBearing(),pitch:t.getPitch(),padding:t.getPadding(),repeat:t.getRenderWorldCopies()};return t.getTerrain?.()&&Ce(t,r),r}function Ce(t,e){if(t.getFreeCameraOptions){let{position:o}=t.getFreeCameraOptions();if(!o||o.z===void 0)return;let r=t.transform.height,{longitude:n,latitude:l,pitch:s}=e,i=o.x*N,c=(1-o.y)*N,a=o.z*N,y=v([n,l]),d=i-y[0],M=c-y[1],I=Math.sqrt(d*d+M*M),T=s*Oe,R=1.5*r,Y=T<.001?R*Math.cos(T)/a:R*Math.sin(T)/I;e.zoom=Math.log2(Y);let se=R*Math.cos(T)/Y,ae=a-se;e.position=[0,0,ae/z(l)]}else typeof t.transform.elevation=="number"&&(e.position=[0,0,t.transform.elevation])}function A(t,e,o){let r=x(e),n=t.getView(w)||_(e);o&&(n.props.nearZMultiplier=.2);let l=o?.nearZ??e.transform._nearZ,s=o?.farZ??e.transform._farZ;return Number.isFinite(l)&&(r.nearZ=l/e.transform.height,r.farZ=s/e.transform.height),n.makeViewport({width:t.width,height:t.height,viewState:r})}function Fe(t,e){let r=(0,b._flatten)(t.props.layers,Boolean).some(i=>i&&!e.getLayer(i.id)),n=t.getViewports(),l=n.findIndex(i=>i.id===w),s=n.length>1||l<0;(r||s)&&(l>=0&&(n=n.slice(),n[l]=A(t,e)),t._drawLayers("mapbox-repaint",{viewports:n,layerFilter:i=>(!t.props.layerFilter||t.props.layerFilter(i))&&(i.viewport.id!==w||!e.getLayer(i.layer.id)),clearCanvas:!1})),t.userData.currentViewport=null}function Re(t,e){t.setProps({viewState:x(e)}),t.needsRedraw({clearRedrawFlags:!0})}var U=m(f(),1);var P=class{constructor(e){if(!e.id)throw new Error("Layer must have an unique id");this.id=e.id,this.type="custom",this.renderingMode=e.renderingMode||"3d",this.slot=e.slot,this.map=null,this.props=e}onAdd(e,o){this.map=e}onRemove(){this.map=null}setProps(e){Object.assign(this.props,e,{id:this.id})}render(e,o){this.map&&te(this.map.__deck,this.map,this,o)}};var Z="__UNDEFINED__";function re(t,e,o,r){if(!t||!e||!t.style||!t.style._loaded)return;let n=(0,U._flatten)(r,Boolean);if(o!==r){let i=(0,U._flatten)(o,Boolean),c=new Set(i.map(a=>a.id));for(let a of n)c.delete(a.id);for(let a of c)t.getLayer(a)&&t.removeLayer(a)}for(let i of n){let c=t.getLayer(i.id);c?(c.implementation||c).setProps(i.props):t.addLayer(new P({id:i.id,slot:i.props.slot}),i.props.beforeId)}let l=t.style._order,s={};for(let i of n){let{beforeId:c}=i.props;(!c||!l.includes(c))&&(c=Z),s[c]=s[c]||[],s[c].push(i.id)}for(let i in s){let c=s[i],a=i===Z?l.length:l.indexOf(i),y=i===Z?void 0:i;for(let d=c.length-1;d>=0;d--){let M=c[d],I=l.indexOf(M);I!==a-1&&(t.moveLayer(M,y),I>a&&a++),a--,y=M}}}var X=m(f(),1);var ne=m(f(),1),D=class{constructor(e){(0,ne.assert)(e.id,"id is required"),this.id=e.id,this.type="custom",this.renderingMode=e.renderingMode||"3d",this.slot=e.slot,this.beforeId=e.beforeId,this.map=null}onAdd(e,o){this.map=e}render(e,o){this.map&&oe(this.map.__deck,this.map,this,o)}};var W="__UNDEFINED__";function B(t){return t.props.beforeId?`deck-layer-group-before:${t.props.beforeId}`:t.props.slot?`deck-layer-group-slot:${t.props.slot}`:"deck-layer-group-last"}function ie(t,e,o){if(!t||!t.style||!t.style._loaded)return;let r=(0,X._flatten)(o,Boolean);if(e!==o){let s=(0,X._flatten)(e,Boolean),i=new Set(s.map(a=>B(a))),c=new Set(r.map(a=>B(a)));for(let a of i)c.has(a)||t.getLayer(a)&&t.removeLayer(a)}let n={};for(let s of r){let i=B(s),c=t.getLayer(i);if(c){let a=c.implementation||c;n[i]=a}else{let a=new D({id:i,slot:s.props.slot,beforeId:s.props.beforeId});n[i]=a,t.addLayer(a,s.props.beforeId)}}let l=t.style._order;for(let[s,i]of Object.entries(n)){let c=i.beforeId||W,a=c===W?l.length:l.indexOf(c);if(l.indexOf(s)!==a-1){let d=c===W?void 0:c;t.moveLayer(s,d)}}}var E=class{constructor(e){this._handleStyleChange=()=>{if(this._resolveLayers(this._map,this._deck,this._props.layers,this._props.layers),!this._map)return;F(this._map)&&!this._props.views&&this._deck?.setProps({views:_(this._map)})};this._updateContainerSize=()=>{if(this._map&&this._container){let{clientWidth:e,clientHeight:o}=this._map.getContainer();Object.assign(this._container.style,{width:`${e}px`,height:`${o}px`})}};this._updateViewState=()=>{let e=this._deck,o=this._map;e&&o&&(e.setProps({views:this._props.views||_(o),viewState:x(o)}),e.isInitialized&&e.redraw())};this._handleMouseEvent=e=>{let o=this._deck;if(!o||!o.isInitialized)return;let r={type:e.type,offsetCenter:e.point,srcEvent:e},n=this._lastMouseDownPoint;switch(!e.point&&n&&(r.deltaX=e.originalEvent.clientX-n.clientX,r.deltaY=e.originalEvent.clientY-n.clientY,r.offsetCenter={x:n.x+r.deltaX,y:n.y+r.deltaY}),r.type){case"mousedown":o._onPointerDown(r),this._lastMouseDownPoint={...e.point,clientX:e.originalEvent.clientX,clientY:e.originalEvent.clientY};break;case"dragstart":r.type="panstart",o._onEvent(r);break;case"drag":r.type="panmove",o._onEvent(r);break;case"dragend":r.type="panend",o._onEvent(r);break;case"click":r.tapCount=1,o._onEvent(r);break;case"dblclick":r.type="click",r.tapCount=2,o._onEvent(r);break;case"mousemove":r.type="pointermove",o._onPointerMove(r);break;case"mouseout":r.type="pointerleave",o._onPointerMove(r);break;default:return}};let{interleaved:o=!1}=e;this._interleaved=o,this._renderLayersInGroups=e._renderLayersInGroups||!1,this._props=this.filterProps(e)}filterProps(e){let{interleaved:o=!1,useDevicePixels:r,...n}=e;return!o&&r!==void 0&&(n.useDevicePixels=r),n}setProps(e){this._interleaved&&e.layers&&this._resolveLayers(this._map,this._deck,this._props.layers,e.layers),Object.assign(this._props,this.filterProps(e)),this._deck&&this._map&&this._deck.setProps({...this._props,parameters:{...C(this._map,this._interleaved),...this._props.parameters}})}onAdd(e){return this._map=e,this._interleaved?this._onAddInterleaved(e):this._onAddOverlaid(e)}_onAddOverlaid(e){let o=document.createElement("div");return Object.assign(o.style,{position:"absolute",left:0,top:0,textAlign:"initial",pointerEvents:"none"}),this._container=o,this._deck=new u.Deck({...this._props,parent:o,parameters:{...C(e,!1),...this._props.parameters},views:this._props.views||_(e),viewState:x(e)}),e.on("resize",this._updateContainerSize),e.on("render",this._updateViewState),e.on("mousedown",this._handleMouseEvent),e.on("dragstart",this._handleMouseEvent),e.on("drag",this._handleMouseEvent),e.on("dragend",this._handleMouseEvent),e.on("mousemove",this._handleMouseEvent),e.on("mouseout",this._handleMouseEvent),e.on("click",this._handleMouseEvent),e.on("dblclick",this._handleMouseEvent),this._updateContainerSize(),o}_onAddInterleaved(e){let o=e.painter.context.gl;return o instanceof WebGLRenderingContext&&u.log.warn("Incompatible basemap library. See: https://deck.gl/docs/api-reference/mapbox/overview#compatibility")(),this._deck=Q({map:e,deck:new u.Deck({...this._props,gl:o,parameters:{...C(e,!0),...this._props.parameters}})}),e.on("styledata",this._handleStyleChange),this._resolveLayers(e,this._deck,[],this._props.layers),document.createElement("div")}_resolveLayers(e,o,r,n){this._renderLayersInGroups?ie(e,r,n):re(e,o,r,n)}onRemove(){let e=this._map;e&&(this._interleaved?this._onRemoveInterleaved(e):this._onRemoveOverlaid(e)),this._deck=void 0,this._map=void 0,this._container=void 0}_onRemoveOverlaid(e){e.off("resize",this._updateContainerSize),e.off("render",this._updateViewState),e.off("mousedown",this._handleMouseEvent),e.off("dragstart",this._handleMouseEvent),e.off("drag",this._handleMouseEvent),e.off("dragend",this._handleMouseEvent),e.off("mousemove",this._handleMouseEvent),e.off("mouseout",this._handleMouseEvent),e.off("click",this._handleMouseEvent),e.off("dblclick",this._handleMouseEvent),this._deck?.finalize()}_onRemoveInterleaved(e){e.off("styledata",this._handleStyleChange),this._resolveLayers(e,this._deck,this._props.layers,[]),ee(e)}getDefaultPosition(){return"top-left"}pickObject(e){return(0,u.assert)(this._deck),this._deck.pickObject(e)}pickMultipleObjects(e){return(0,u.assert)(this._deck),this._deck.pickMultipleObjects(e)}pickObjects(e){return(0,u.assert)(this._deck),this._deck.pickObjects(e)}finalize(){this._map&&this._map.removeControl(this)}getCanvas(){return this._map?this._interleaved?this._map.getCanvas():this._deck.getCanvas():null}};return me(k);})();
      return __exports__;
      });
